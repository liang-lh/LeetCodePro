#\n# @lc app=leetcode id=3768 lang=golang\n#\n# [3768] Minimum Inversion Count in Subarrays of Fixed Length\n#\n\n# @lc code=start\nfunc minInversionCount(nums []int, k int) int64 {\n\tif k == 1 {\n\t\treturn 0\n\t}\n\tn := len(nums)\n\tvals := make([]int, n)\n\tcopy(vals, nums)\n\tsort.Ints(vals)\n\tunique := []int{}\n\tfor i := 0; i < n; i++ {\n\t\tif i == 0 || vals[i] != vals[i-1] {\n\t\t\tunique = append(unique, vals[i])\n\t\t}\n\t}\n\tm := len(unique)\n\trank := make(map[int]int)\n\tfor i, v := range unique {\n\t\trank[v] = i + 1\n\t}\n\n\tft := make([]int64, m+2)\n\tupdate := func(idx int, delta int64) {\n\t\tfor idx <= m {\n\t\t\tft[idx] += delta\n\t\t\tidx += idx & -idx\n\t\t}\n\t}\n\tprefix := func(idx int) int64 {\n\t\tvar res int64\n\t\tfor idx > 0 {\n\t\t\tres += ft[idx]\n\t\t\tidx -= idx & -idx\n\t\t}\n\t\treturn res\n\t}\n\tvar inv int64 = 0\n\tfor i := 0; i < k; i++ {\n\t\trnk := rank[nums[i]]\n\t\tnum_greater := int64(i) - prefix(rnk)\n\t\tinv += num_greater\n\t\tupdate(rnk, 1)\n\t}\n\tminInv := inv\n\tfor l := 0; l < n-k; l++ {\n\t\trnk_l := rank[nums[l]]\n\t\tnum_smaller := prefix(rnk_l - 1)\n\t\tinv -= num_smaller\n\t\tupdate(rnk_l, -1)\n\t\trnk_new := rank[nums[l+k]]\n\t\tnum_greater := int64(k-1) - prefix(rnk_new)\n\t\tinv += num_greater\n\t\tupdate(rnk_new, 1)\n\t\tif inv < minInv {\n\t\t\tminInv = inv\n\t\t}\n\t}\n\treturn minInv\n}\n# @lc code=end