#\n# @lc app=leetcode id=3519 lang=java\n#\n# [3519] Count Numbers with Non-Decreasing Digits\n#\n\n# @lc code=start\nclass Solution {\n    public int countNumbers(String l, String r, int b) {\n        final long MOD = 1000000007L;\n        java.math.BigInteger bigL = new java.math.BigInteger(l);\n        java.math.BigInteger bigR = new java.math.BigInteger(r);\n        long cntR = count(bigR, b, MOD);\n        long cntLm1 = count(bigL.subtract(java.math.BigInteger.ONE), b, MOD);\n        long ans = (cntR - cntLm1 + MOD) % MOD;\n        return (int) ans;\n    }\n\n    private static long count(java.math.BigInteger n, int base, long mod) {\n        if (n.compareTo(java.math.BigInteger.ZERO) < 0) {\n            return 0L;\n        }\n        int[] digits = getBaseBDigits(n, base);\n        int len = digits.length;\n        long[][][] dp = new long[len + 1][2][base];\n        for (int t = 0; t < 2; ++t) {\n            for (int p = 0; p < base; ++p) {\n                dp[len][t][p] = (p == 0 ? 0L : 1L);\n            }\n        }\n        for (int pos = len - 1; pos >= 0; --pos) {\n            for (int t = 0; t < 2; ++t) {\n                int up = t == 1 ? digits[pos] : base - 1;\n                for (int p = 0; p < base; ++p) {\n                    long res = 0L;\n                    for (int d = 0; d <= up; ++d) {\n                        if (p != 0 && d < p) continue;\n                        int np = p == 0 ? (d == 0 ? 0 : d) : d;\n                        int nt = (t == 1 && d == up) ? 1 : 0;\n                        res = (res + dp[pos + 1][nt][np]) % mod;\n                    }\n                    dp[pos][t][p] = res;\n                }\n            }\n        }\n        return dp[0][1][0];\n    }\n\n    private static int[] getBaseBDigits(java.math.BigInteger n, int base) {\n        java.util.List<java.lang.Integer> digits = new java.util.ArrayList<>();\n        java.math.BigInteger bb = java.math.BigInteger.valueOf((long) base);\n        java.math.BigInteger num = n;\n        while (num.compareTo(java.math.BigInteger.ZERO) > 0) {\n            digits.add(num.mod(bb).intValue());\n            num = num.divide(bb);\n        }\n        java.util.Collections.reverse(digits);\n        int[] res = new int[digits.size()];\n        for (int i = 0; i < res.length; ++i) {\n            res[i] = digits.get(i);\n        }\n        return res;\n    }\n}\n# @lc code=end